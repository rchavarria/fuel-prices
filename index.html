<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gasolineras</title>
</head>
<body>

<table>
    <thead>
    <tr>
        <td>Estación</td>
        <td>Precio</td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td>Barata de Alcampo</td>
        <td id="4280-3079"></td>
    </tr>
    <tr>
        <td>GALP rotonda Meco</td>
        <td id="4280-3067"></td>
    </tr>
    <tr>
        <td>GALP antigüo Quirón</td>
        <td id="4280-2929"></td>
    </tr>
    <tr>
        <td>GALP vía de servicio N-II</td>
        <td id="4280-4697"></td>
    </tr>
    <tr>
        <td>GALP vía de servicio N-II</td>
        <td id="4280-4698"></td>
    </tr>
    <tr>
        <td>GALP rotonda Fiat</td>
        <td id="4280-12721"></td>
    </tr>
    <tr>
        <td>Guadalajara: GALP rotonda Bici</td>
        <td id="2945-8292"></td>
    </tr>
    <tr>
        <td>Pioz: Repsol</td>
        <td id="3023-11591"></td>
    </tr>
    </tbody>
</table>

<script>
  (async () => {
    async function listCitiesByProvince(province) {
      const response = await fetch(`https://sedeaplicaciones.minetur.gob.es/ServiciosRESTCarburantes/PreciosCarburantes/Listados/MunicipiosPorProvincia/${province}`,
        {
          method: 'GET',
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json',
          },
        })

      return await response.json();
    }

    async function stationsByCity(city) {
      const response = await fetch(`https://sedeaplicaciones.minetur.gob.es/ServiciosRESTCarburantes/PreciosCarburantes/EstacionesTerrestres/FiltroMunicipio/${city}`,
        {
          method: 'GET',
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json',
          },
        })

      return await response.json()
    }

    async function fetchPrice(cityId, stationId, product) {
      const stations = await stationsByCity(cityId)
      const station = stations.ListaEESSPrecio.find(s => s.IDEESS === stationId)
      return station[product]
    }

    async function load(cityId, stationId) {
      const price = await fetchPrice(cityId, stationId, 'Precio Gasoleo A')
      const element = document.getElementById(`${cityId}-${stationId}`)
      if (!element) {
        return
      }

      element.innerHTML = `<div>${price} €</div>`
    }

    await load('4280', '3079')
    await load('4280', '3067')
    await load('4280', '2929')
    await load('4280', '4697')
    await load('4280', '4698')
    await load('4280', '12721')
    await load('2945', '8292')
    await load('3023', '11591')
  })()
</script>
</body>
</html>
